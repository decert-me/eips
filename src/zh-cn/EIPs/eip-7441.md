---
eip: 7441
title: 升级区块提议者选举至 Whisk
description: 允许当选的区块提议者在区块发布之前保持私密，以防止 DoS 攻击
author: George Kadianakis (@asn-d6), Justin Drake (@JustinDrake), dapplion (@dapplion)
discussions-to: https://ethereum-magicians.org/t/eip-7441-upgrade-block-proposer-election-to-whisk-ssle/15316
status: Stagnant
type: Standards Track
category: Core
created: 2023-09-01
---

## 摘要

将区块提议者选举机制升级至 Whisk，一个单一秘密领导者选举（SSLE）协议。目前，区块提议者在提前是公开已知的，足以允许顺序 DoS 攻击，这可能会使以太坊瘫痪。此升级允许下一个区块提议者在其区块发布之前保持秘密。

## 动机

信标链目前在每个纪元开始时选举下一个 32 个区块提议者。此选举的结果是公开的，所有人都能了解到这些未来区块提议者的身份。

这一信息泄露使攻击者能够对每个提议者发起顺序 DoS 攻击，试图使以太坊瘫痪。

## 规范

### 执行层

这对执行层没有任何更改要求。

### 共识层

该协议可以总结为以下并发步骤：

- 验证者在分叉后的第一次提议中注册一个跟踪器和唯一承诺
- 在洗牌阶段开始时，使用 RANDAO 的公共随机性选择候选跟踪器列表
- 在每个洗牌阶段中，每个提议者使用私有随机性对候选跟踪器的子集进行洗牌
- 在每个洗牌阶段结束后，从候选集中使用 RANDAO 选择一个有序的提议者跟踪器列表

提议变更的完整规范可以在 [`/_features/whisk/beacon-chain.md`](https://github.com/ethereum/consensus-specs/blob/a39abe388bc2d1abd5b4fd62fd18aed497956b30/specs/_features/whisk/beacon-chain.md) 中找到。总结如下：

- 更新 `BeaconState`，添加跟踪验证者跟踪器、承诺和两轮候选选举所需的字段。
- 添加 `select_whisk_candidate_trackers` 以从验证者集计算下一个候选向量。
- 添加 `select_whisk_proposer_trackers` 以从当前候选中计算下一个提议者向量。
- 添加 `process_whisk_updates` 到纪元处理逻辑中。
- 添加 `process_whisk_opening_proof` 以验证区块提议者对该时隙选定跟踪器的知识。
- 修改 `process_block_header`，不再使用 `get_beacon_proposer_index` 断言提议者选举，而是断言有效的开启证明。
- 更新 `BeaconBlockBody`，添加提交开启证明、带证明的洗牌跟踪器和带证明的跟踪器注册的字段。
- 添加 `get_shuffle_indices` 以计算预洗牌候选选择
- 添加 `process_shuffled_trackers` 以提交洗牌候选跟踪器。
- 添加 `process_whisk` 到区块处理逻辑中。
- 修改 `apply_deposit` 以在没有熵的情况下注册初始唯一跟踪器和承诺。

## 理由

### 每个验证者的字段

Whisk 需要每个验证者有一个跟踪器 `(rG,krG)` 和一个唯一承诺 `kG`。这两者仅在验证者分叉后的第一次提议时更新一次。

跟踪器使用随机基础 `(rG,krG)` 注册，以使对手更难通过洗牌门跟踪它们。如果诚实洗牌者的数量较少，这可能会成为一个问题。

### 身份绑定

每个跟踪器必须绑定到验证者的身份，以防止多个方声称同一个提议者时隙。否则，这将允许提议者出售其提议者时隙，并在出现两个竞争区块时导致分叉选择问题。

Whisk 通过在验证者记录中存储对跟踪器秘密 `kG` 的承诺来实现身份绑定。存储承诺还确保了 `k` 的唯一性。

另外，身份绑定可以通过强制 `hash(kG)` 的哈希前缀与其验证者索引匹配来实现。然而，验证者将不得不暴力破解 `k`，这使得系统的引导对计算资源较少的参与者更困难。

身份绑定也可以通过设置 `k = hash(nonce + pubkey)` 来实现。然而，提议者需要揭示 `k`，并在相邻洗牌阶段的重复提议中被去匿名化。

### 替代方案：非单一秘密选举

秘密非单一领导者选举可以基于协议工程而非密码学，因此比 Whisk 更简单和便宜。然而，这会使分叉选择复杂化，并使其面临潜在的 MEV 时间购买攻击，因此在撰写时并不是一个合适的选择。

### 替代方案：网络匿名性

像 Dandelion 或 Dandelion++ 这样的隐私保护网络协议增加了网络参与者的隐私，但对于以太坊的用例来说并不够充分。

SASSAFRAS 是一个更简单的 SSLE 协议，在共识上更简单，但它依赖于网络匿名层。其特定的权衡并不比 Whisk 更适合以太坊的整体威胁模型。

## 向后兼容性

此 EIP 引入了对共识层区块验证规则集的向后不兼容更改，必须伴随硬分叉。

PBS 参与者（例如构建者）将不知道下一个提议者验证者索引以使用特定的预注册费用接收者；除非提议者选择提前揭示自己。区块浏览器和工具将无法将缺失的时隙归因于特定的验证者索引。

## 安全考虑

洗牌策略在一篇伴随论文中进行了分析，并被认为对 Whisk 的用例足够安全。此 EIP 的数据和计算复杂性显著但恒定，因此不会打开新的 DoS 向量。

### 匿名性集合

Whisk 中的匿名性集合是未被选为提议者的 8,192 个候选者的集合。该验证者的数量对应于较少的 p2p 节点数量。假设一个帕累托原则，即“20% 的节点运行 80% 的验证者”，则匿名性平均对应于 2,108 个节点。更大的候选池可能会使洗牌策略不安全，而每轮洗牌更多跟踪器将增加 ZK 证明的成本。

### RANDAO 偏差

Whisk 在候选选择和提议者选择事件中使用 RANDAO，并且容易受到恶意提议者的潜在 RANDAO 偏差攻击。通过在整个洗牌期间分散选择事件，可以使 Whisk 的安全性与现状相同。然而，现状的安全性也并不理想，这将进一步复杂化协议。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。