---
eip: 4488
title: 通过总 calldata 限制减少交易 calldata 的 gas 成本
description: 大幅降低交易 calldata 的 gas 成本，同时限制区块中的总交易 calldata
author: Vitalik Buterin (@vbuterin), Ansgar Dietrichs (@adietrichs)
discussions-to: https://ethereum-magicians.org/t/eip-4488-transaction-calldata-gas-cost-reduction-with-total-calldata-limit/7555
type: Standards Track
category: Core
status: Stagnant
created: 2021-11-23
---

## 摘要

降低交易 calldata 的 gas 成本，并添加限制区块中总交易 calldata 的大小。

## 动机

在短期和中期，甚至可能在长期，Rollups 是以太坊唯一的无信任扩展解决方案。L1 的交易费用已经高达数月，迫切需要采取措施以促进整个生态系统向 Rollups 的转变。Rollups 显著降低了许多以太坊用户的费用：Optimism 和 Arbitrum 的费用通常比以太坊基础层低 ~3-8 倍，而 ZK Rollups 由于具有更好的数据压缩能力且可以避免包含签名，其费用比基础层低 ~40-100 倍。

然而，即使这些费用对许多用户来说仍然太贵。长期以来，Rollups 自身的长期不足的解决方案一直是 [数据分片](https://github.com/ethereum/consensus-specs#sharding)，这将为链上的 Rollups 添加 ~1-2 MB/sec 的专用数据空间。然而，数据分片的实施和部署仍需相当长的时间。因此，迫切需要一种短期解决方案，以进一步降低 Rollups 的成本，并激励整个生态系统向以 Rollup 为中心的以太坊过渡。

该 EIP 提出了一个快速实施的短期解决方案，同时减轻了安全风险。

## 规范

| 参数 | 值 |
| - | - |
| `NEW_CALLDATA_GAS_COST` | `3` |
| `BASE_MAX_CALLDATA_PER_BLOCK` | `1,048,576` |
| `CALLDATA_PER_TX_STIPEND` | `300` |

将交易 calldata 的 gas 成本降低到每字节 `NEW_CALLDATA_GAS_COST`，无论字节是零还是非零。

添加一条规则，只有当 `sum(len(tx.calldata) for tx in block.txs) <= BASE_MAX_CALLDATA_PER_BLOCK + len(block.txs) * CALLDATA_PER_TX_STIPEND` 时，区块才是有效的。

## 理由

一个自然的替代提案是降低 `NEW_CALLDATA_GAS_COST` 而不添加限制。然而，这会带来安全隐患：今天，平均区块大小 [为 60-90 kB](https://etherscan.io/chart/blocksize)，但 _最大_ 区块大小为 `30M / 16 = 1,875,000` 字节（加上大约一千字节的区块和交易开销）。仅仅将 calldata gas 成本从 16 降至 3 将使最大区块大小增加到 10M 字节。这将使以太坊的 P2P 网络层承受前所未有的压力，并有可能导致网络崩溃；几年前对 ~500 kB 区块的某些现场测试已经导致一些引导节点崩溃。

降低成本并限制提案实现了大部分降低的好处，因为在短期内 Rollups 不太可能 _主导_ 以太坊区块空间，因此 1.5 MB 将是足够的，同时防止大部分安全风险。

历史上，以太坊协议社区对多维资源限制规则（在这种情况下，gas 和 calldata）持怀疑态度，因为此类规则大大增加了提案者（今天的矿工，合并后的验证者）需要解决的区块打包问题的复杂性。今天，提案者可以通过简单地按优先费用从高到低选择交易来生成接近最佳费用收入的区块。在多维世界中，提案者将不得不处理多维约束。多维背包问题比单维等价物复杂得多，矿池构建的经过良好优化的专有实现可能会优于默认的开源实现。

今天，有两个关键原因使得这比以前的问题要小：

1. [EIP-1559](./eip-1559.md) 意味着，至少在大多数情况下，区块提案者所解决的问题 _不是_ 背包问题。相反，区块提案者只是包括所有他们能找到的具有足够基础费用和优先费用的交易。因此，简单的算法也会经常生成接近最佳的结果。
2. 复杂的专有策略的存在使得矿工可提取价值（MEV）提取意味着去中心化的最佳区块生产在中长期内已经是一个失去的事业。研究转而关注将专注于区块体生成的任务与验证者的角色分离的解决方案（“提案者/构建者分离”）。因此，今天的二维背包问题将仅仅是“又一个” MEV 机会。

因此，值得重新思考历史上对多维资源限制的反对，并将其视为同时实现适度扩展收益的务实方式，同时保持安全性。

此外，津贴机制使得二维优化问题在实践中变得更不成问题。90% 的所有交易（[样本](../assets/eip-4488/gas_and_calldata_sample.csv) 取自区块 `13500000, 13501000 ... 13529000`）的 calldata 小于 300 字节。因此，如果一个简单的交易选择算法超出了提案者正在创建的区块的 calldata，提案者仍然可以继续从 90% 的内存池中添加交易。

## 向后兼容性

这是一个向后不兼容的 gas 重新定价，需要计划中的网络升级。

用户将能够继续无更改地操作。

矿工将能够继续无更改地操作，除了在总 calldata 大小达到最大值时停止向区块中添加新交易的规则。然而，他们可以添加一些务实的启发式方法，以在这种情况下实现更接近最佳的回报：例如，如果一个区块填满到大小限制，他们可以反复删除最后一个数据量大的交易，并用尽可能多的数据量小的交易替换它，直到这样做不再有利可图。

## 安全考虑

该提案并未增加链的 _突发_ 数据容量（实际上，它略微减少）。然而，_平均_ 数据容量将增加。这意味着历史存储的存储要求将上升。最坏的情况是理论上的长期最大值为 ~1,262,861 字节每 12 秒插槽，或每年 ~3.0 TB。

我们建议在此 EIP 同时或不久后实施 [EIP-4444](./eip-4444.md) 或一些类似的历史过期提案，以减轻这一风险。

## 版权

通过 [CC0](../LICENSE.md) 放弃版权及相关权利。