---
eip: 2029
title: 状态租赁 A - 状态计数器合约
author: Alexey Akhunov (@AlexeyAkhunov)
discussions-to: https://ethereum-magicians.org/t/eip-2029-state-counters-contract-change-a-from-state-rent-v3-proposal/3279
status: Stagnant
type: Standards Track
category: Core
created: 2019-05-15
---

## 简单总结
一个智能合约在所有以太坊网络上以预定地址部署，代码仅仅读取其存储中由唯一参数指定的槽。后来，这个合约变得“特殊”，因为以太坊开始将状态计数器（总交易数、账户数等）写入该合约。

## 摘要
这是状态租赁路线图的一部分。这个特定的变化引入了一个以太坊状态中的位置，可以存储各种状态计数器。在这一点上，最重要的计数器是发生的总交易数，这个计数器将用于填充新创建的非合约账户的 nonce。这种填充 nonce 的方式确保了被驱逐的账户在通过发送以太币重新激活后具有重放保护。

## 动机
以太坊目前在状态中没有一个特殊的位置来跟踪状态计数器，例如交易数或账户数。

## 规范
在区块 A 之前，部署一个合约，代码如下：
`0x60 0x20 0x60 0x00 0x80 0x80 0x35 0x54 0x90 0x52 0xF3`，对应的汇编为：
`PUSH1 32 PUSH1 0 DUP1 DUP1 CALLDATALOAD SLOAD SWAP1 MSTORE RETURN`
对该合约的调用接受一个 32 字节的参数 `x`，并返回存储项 [`x`] 的值。

该合约使用 `CREATE2` 操作码以确保在任何网络上具有相同的地址进行部署。

## 理由
到目前为止，考虑了两种替代解决方案：
1. 扩展以太坊状态的结构以引入更多字段，从而改变状态根的构造方式。这种方法的主要缺点是对当前与状态根构造特定方式耦合的软件的影响。特别是它影响处理从状态根派生的默克尔证明的软件。
2. 扩展状态预言机（[EIP-2014](./eip-2014.md)）。在这种提案下，将有一个具有标准化接口的预编译合约，能够返回计数器的当前值。然而，这种预言机返回的实际数据并不明确在状态中，也没有进行默克尔化。这意味着所有计数器在快照同步时需要添加到快照中，因此它们仍然存在于状态中，但隐式存在。

## 向后兼容性
此更改向后兼容，不需要激活硬分叉。

## 测试用例
将创建测试用例以确保状态计数器合约正确返回其存储项。

## 实现
实现设想为可以从任何以太坊地址发布的交易，将导致状态计数器合约的部署。

## 版权
版权及相关权利通过 [CC0](../LICENSE.md) 放弃。