---
eip: 2035
title: 无状态客户端 - 重新定价 SLOAD 和 SSTORE 以支付区块证明
author: Alexey Akhunov (@AlexeyAkhunov)
discussions-to: https://ethereum-magicians.org/t/eip-2035-stateless-clients-repricing-sload-and-sstore-to-pay-for-block-proofs/3284
status: 停滞
type: 标准跟踪
category: 核心
created: 2019-05-16
---

## 简单总结
EVM 操作码 `SLOAD` 和 `SSTORE` 的 gas 成本增加，以适应传播区块证明所需的额外带宽，连同区块头和区块体一起传播，如 [这里](https://medium.com/@akhounov/data-from-the-ethereum-stateless-prototype-8c69479c8abc) 所述。

## 摘要
这是状态租赁路线图的一部分。这个特定的变化为以引入区块证明做准备（目前的理解是它们可以在不进行硬分叉的情况下引入）。区块证明的引入允许任何希望接收它们的以太坊节点在不需要访问以太坊状态的情况下处理区块中的交易。执行所需的所有信息（以及有效性的证明）都包含在区块证明中。在大多数以太坊节点中，这将加快区块处理速度并减少此类处理的内存占用。然而，对于挖矿节点来说，构建和传输区块证明将需要更多的工作。因此，引入了额外的费用（支付给矿工）。在第一阶段，只有合约存储将由区块证明覆盖。这意味着以太坊节点仍然需要访问状态中的账户，但区块证明将使访问合约存储在执行交易时变为可选。因此，只有 `SSTORE` 和 `SLOAD` 操作码受到影响。

## 动机
有 [实证分析](https://github.com/holiman/vmstats/blob/master/README.md) 显示，`SLOAD` 操作码在区块处理时增加的执行延迟方面目前定价过低。假设这是由于数据库访问的延迟。在同一分析中，`SSTORE` 没有被考虑，因为它对数据库访问的影响可以（并且在许多实现中）延迟到区块结束时。无状态客户端对合约存储的处理将大大消除这种延迟，因为不需要数据库访问。相反，带宽消耗增加。有实证分析（未发布，但将会发布）表明，1 次未缓存的 `SSTORE` 或 `SLOAD` 至多会增加 1 kB 到区块证明。在当前的数据传输成本（每字节 68 gas）下，这将导致这两种操作的 gas 成本增加 69k gas。然而，考虑到 [EIP-2028](./eip-2028.md) 中的提议，增加的幅度可以大大减小。

## 规范
目前不是很正式，但将在更多研究和原型制作后正式化。当存储槽被访问（通过 `SLOAD` 读取或通过 `SSTORE` 写入）而在同一交易中未被先前访问（通过另一个 `SLOAD` 或 `SSTORE`）时，操作 `SLOAD` 和 `SSTORE` 的 gas 增加 `X` gas。

未来的变体（在实施 *总合约大小计费* 后将可能实现）正在研究，其中增加的幅度根据合约存储的大小而变化，即对于较小的合约，`SLOAD` 和 `SSTORE` 将更便宜。

## 理由
[EIP-1884](./eip-1884.md) 试图增加 `SLOAD` 的 gas 成本，但使用了不同的理由（如动机中所述的执行延迟）。这个 EIP 可能会以更大的幅度增加 `SLOAD` 的成本，因此部分（因为 EIP-1884 还提议了其他增加）取代了 EIP-1884。

[EIP-2028](./eip-2028.md) 描述了可以用于决定数据传输 gas 成本的模型。这是相关的，因为在无状态客户端模式下，`SSTORE` 和 `SLOAD` 操作会增加更多需要传输的数据（以及验证证明的计算）。

主要的替代设计是与合约存储大小成比例的租金，这不幸地引入了严重的恶意攻击漏洞问题，目前的解决方案似乎是在重新设计和重写智能合约，使其不易受到攻击。然而，这种方法在非技术（生态系统）层面上可能非常昂贵。

## 向后兼容性
此更改不向后兼容，需要进行硬分叉才能激活。此更改可能对已部署的合约产生不利影响。预计在此 EIP 和 [EIP-2026](./eip-2026.md)（账户的租金预付款）之后，将建议提高 gas 限制。这可以在一定程度上减轻 EIP 的不利影响。最棘手的情况是那些假设 `SLOAD` 和 `SSTORE` 的某些 gas 成本并在其内部 gas 计算中硬编码的合约。对于其他合约，与合约存储的交互成本将上升，可能使基于此类交互的一些 dApp 变得不可行。这是为了避免与合约存储大小成比例的租金带来的更大不利影响。然而，需要更多的研究来更全面地分析可能受影响的合约。

## 测试用例
测试用例将基于参考实现生成。

## 实施
将进行概念验证实施，以完善和澄清规范。

## 版权
版权及相关权利通过 [CC0](../LICENSE.md) 放弃。