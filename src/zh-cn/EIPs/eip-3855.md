---
eip: 3855
title: PUSH0 指令
description: 引入一个新的指令，将常量值 0 推送到栈上
author: Alex Beregszaszi (@axic), Hugo De la cruz (@hugo-dc), Paweł Bylica (@chfast)
discussions-to: https://ethereum-magicians.org/t/eip-3855-push0-instruction/7014
status: Final
type: Standards Track
category: Core
created: 2021-02-19
---

## 摘要

引入 `PUSH0` (`0x5f`) 指令，该指令将常量值 0 推送到栈上。

## 动机

许多指令期望偏移量作为输入，在许多情况下这些偏移量为零。一个很好的例子是 `CALL` 的返回数据参数，如果合约更倾向于使用 `RETURNDATA*`，则这些参数被设置为零。这只是一个例子，但还有许多其他原因使得合约需要推送零值。它们今天可以通过 `PUSH1 0` 来实现，这在运行时成本为 3 gas，并且编码为两个字节，这意味着部署成本为 `2 * 200` gas。

由于整体成本，许多人尝试使用各种其他指令来实现相同的效果。常见的例子包括 `PC`、`MSIZE`、`CALLDATASIZE`、`RETURNDATASIZE`、`CODESIZE`、`CALLVALUE` 和 `SELFBALANCE`。其中一些仅需 2 gas，且长度为一个字节，但其值可能依赖于上下文。

我们对主网进行了分析（区块范围 8,567,259…8,582,058 和 12,205,970…12,817,405），约 11.5% 的所有 `PUSH*` 指令执行时推送了零值。

此次更改的主要动机包括：
1. 减少合约代码大小。
2. 降低合约（误）使用各种指令作为优化措施的风险。重新定价/更改这些指令可能更具风险。
3. 减少使用 `DUP` 指令复制零的需求。

为了让“浪费”更具可比性，现有账户中有 340,557,331 字节因 `PUSH1 00` 指令而浪费，这意味着花费了 68,111,466,200 gas 来部署它们。实际上，许多这些账户与其他账户共享相同的字节码，因此它们在客户端中的总存储大小较小，但部署时间成本仍然必须支付。

对于 2) 的一个例子是更改 `RETURNDATASIZE` 的行为，使其在调用帧开始时可能不保证为零。

## 规范

指令 `PUSH0` 被引入，操作码为 `0x5f`。它没有立即数据，不从栈中弹出任何项，并将一个值为 0 的单个项放入栈中。该指令的成本为 2 gas（即 `base`）。

## 理由

### Gas 成本

`base` gas 成本用于将常量值放入栈中的指令，例如 `ADDRESS`、`ORIGIN` 等。

### 操作码

`0x5f` 意味着它与其余的 `PUSH` 实现处于“连续”空间中，并且可能共享实现。

## 向后兼容性

此 EIP 引入了一个之前不存在的新操作码。使用此操作码的已部署合约在此 EIP 之后可能会改变其行为。

## 测试用例

- `5F` -- 成功执行，栈中包含一个项，值为零
- `5F5F..5F`（1024 次）-- 成功执行，栈中包含 1024 个项，均为零
- `5F5F..5F`（1025 次）-- 执行因栈溢出而中止

## 安全考虑

作者未发现对安全性的任何影响。请注意，跳转目的地分析不受影响，因为 `PUSH0` 没有立即数据字节。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。