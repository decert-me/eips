---
eip: 6914
title: 重用已撤回的验证者索引
description: 重用完全撤回且安全可重用的验证者索引以进行新的信标链存款。
author: Lion (@dapplion), Danny Ryan (@djrtwo)
discussions-to: https://ethereum-magicians.org/t/eip-6914-reuse-withdrawn-validator-indices/15253
status: Stagnant
type: Standards Track
category: Core
created: 2023-04-19
---

## 摘要

在经过足够的安全可重用期后，重用完全撤回的验证者索引，以消除随着验证者集更替而导致的信标链验证者列表的无限增长。

## 动机

信标链维护一个验证者列表和一个与每个验证者相关的余额列表。当新的验证者进行新的存款时，当前机制仅仅是附加，而不是重用之前完全撤回的验证者索引。随着验证者完全撤回和新验证者的加入，这意味着这两个列表将无限增长。

该规范允许在安全的情况下重用验证者索引，从而消除对无限验证者列表增长的担忧。

## 规范

### 共识层

规范的配置值和机制可以在 [共识层规范](https://github.com/ethereum/consensus-specs/blob/1a38b83e5db8638ee01c9461cccf11e7d8a3ebce/specs/_features/eip6914) 中找到。

请注意，只有在验证者已完全撤回 *并且* 验证者在足够的安全期内可撤回时，才会重用验证者索引。

### 执行层

该规范不需要对执行层进行任何更改。

## 理由

每当新的公钥进行新的存款时，`validators` 和 `balances` 列表当前都会附加。由于质押者在长时间跨度内进入和离开共识的自然机制，这些列表以及状态大小将无限增长。

状态大小的增加代表了客户端实现中的负载和/或复杂性。这表现为客户端内存占用、状态根计算、验证者集扫描等。这是在状态转换中相对简单的清理，将防止不必要的负载和复杂性。

## 向后兼容性

这是对以太坊共识层的向后不兼容更改，必须通过硬分叉进行调度。

执行层没有向前/向后兼容性问题。

## 测试用例

测试用例正在标准共识层测试中进行中。

## 安全考虑

验证者索引不能立即重用，而必须等待 `SAFE_EPOCHS_TO_REUSE_INDEX` 个纪元，以确保证明不能被已撤回的验证者签名“污染”——因此不可削减——至少在弱主观性期间内。

证明污染攻击依赖于两个事实：

* 重用验证者索引会覆盖信标状态中先前验证者的公钥。
* `AttesterSlashing` 包含验证者索引以重建签名参与者。

### 攻击细节

假设攻击者占比为 1/3。攻击者在诚实链上退出 N 个验证者，其中 N 是验证者集的小部分。这些验证者离开退出队列，并在几天内可撤回。现在 N 个新的存款进来，覆盖了这些验证者，最重要的是他们的公钥。

然后，攻击者构建一个替代攻击者链，从 N 个自愿退出之前的状态开始，使得原始的 N 个验证者没有退出和撤回。N 足够大，以至于在攻击者链的每个委员会中平均至少有一个 N 的公钥。攻击者双重签名以尝试最终确定攻击者链，但确保 N 个公钥中的一个混入任何揭示的双重签名聚合证明中——单个证明不可用，只有聚合。这些恶意证明 *不能* 包含在诚实链中，因为 `AttesterSlashing` 依赖于将验证者索引映射到特定公钥，从而破坏可追责安全性。

### 缓解措施

在 `SAFE_EPOCHS_TO_REUSE_INDEX` 个纪元（3 倍的最大弱主观性期间）内不覆盖已撤回的验证者，确保在可追责安全窗口内证明不会被污染。

### 替代方案

请注意，如果 `AttesterSlashing` 包含公钥列表而不是验证者索引，那么这将不是问题。然而，这将需要更多的破坏性更改，并将 `AttesterSlashing` 的数据需求增加 6 倍，这是共识层中最大的 数据类型。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。