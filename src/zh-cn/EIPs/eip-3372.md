---
eip: 3372
title: 5 个 FNV 素数用于 ethash
status: 停滞
type: 标准跟踪
category: 核心
author: mineruniter969 (@mineruniter969), mineruniter969 <mineruniter969@tutanota.com>
discussions-to: https://ethereum-magicians.org/t/eip-3372-apply-minor-modifications-to-the-ethash-algorithm-to-break-current-asic-implementations-eip-969-resubmission/5655
created: 2021-03-13
---

## 简单总结

在 ethash 算法中引入 5 个新的 FNV 素数。

## 摘要

本 EIP 旨在通过更改 `fnv` 常量将当前的 ASIC 实现驱逐出网络，以保持以太坊网络的安全和健康。

## 动机

ASIC 为以太坊网络带来了严重的中心化风险。如果我们不摆脱它们，小型 GPU 矿工将被迫退出以太坊挖矿，因为 EIP-1559 将使他们以亏损的方式进行挖矿。此外，ASIC 的生产将仅集中在一两个参与者手中，这将使以太坊的哈希率集中化。值得注意的是，Ethash ASIC 机器的成本超过 1 万美元，而 GPU 的价格低于 1000 美元。

使用 GPU，矿工可以切换到其他挖矿算法，但使用 ASIC 则不可能。保持现状几乎肯定会导致以太坊 2.0 的整合对矿工来说非常艰难。

简而言之，本 EIP 是为了保持以太坊网络的稳定和去中心化，避免 ASIC 业务的影响。

## 规范

如果 `block.number >= ETHASH11_BLKNUM`，则激活 `ethash1.1` 算法版本。

### ethash1.1

在此更改之前，`fnv` 哈希函数在 `hashimoto` 函数中被使用。`fnv` 在所有步骤中都是相同的，`ethash1.1` 将引入额外的 `fnvA`、`fnvB`、`fnvC`、`fnvD` 和 `fnvE` 函数。所有这些函数将具有不同的 FNV 常量。

```
// Previously used FNV prime
#define FNV_PRIME_0 0x1000193

// New FNV primes
#define FNV_PRIME_A 0x10001a7
#define FNV_PRIME_B 0x10001ab
#define FNV_PRIME_C 0x10001cf
#define FNV_PRIME_D 0x10001e3
#define FNV_PRIME_E 0x10001f9
```

在此 EIP 之前，Ethash 的所有部分都使用 `fnv`（以下称为 `fnv0`）函数。根据本 EIP 的引入：
* `fnvA` 在 DAG 项选择步骤中替换 `fnv0`
* `fnvB` 在 DAG 项混合步骤中替换 `fnv0`
* `fnvC(fnvD(fnvE` 在压缩混合步骤中替换 `fnv0(fnv0(fnv0(`
* DAG 生成步骤中的 `fnv0` 应保持不变。

## 理由

ASIC 矿工已成为以太坊未来的威胁，必须进行硬分叉以在造成进一步损害之前将其从网络中移除。EIP-3372 提出了实现这一目标所需的最低限度，并且不会像 Ethash 2.0 那样影响 ETH 的利益相关者或网络。ASIC 所带来的威胁是法律、社会、道德、技术、货币和环境方面的。随着我们逐渐接近合并，ASIC 将像过去一样攻击网络和开发者，因为矿工总是追求利润。

在法律和社会层面，ASIC 之前一直是威胁和麻烦。正如哈德森所描述的，Linzhi 攻击了以太坊基金会和开发者，试图传播谎言和错误信息，同时在讨论 EIP-1057 时发出法律威胁。他的账户在 [这里](https://github.com/Souptacular/linzhi)，他自己说：

> ASIC 制造商 Linzhi 一方面对我施加压力，另一方面撒谎

他们对员工的攻击和骚扰在下面的图片中得以体现：
![](upload://n8TJsS8hEEH4DXYJ2WDzblm5qJo.jpeg)

在社会和道德层面，以太坊社区必须对对其开发者的个人攻击采取零容忍政策。正是因为核心开发者，以太坊才有价值，社区不能允许大型公司肆意攻击他们，必须保护每位开发者，因为他们是保持以太坊生存的资源。在这一事件中，多位开发者遭受了“烧伤”。随着我们加速合并，ASIC 公司很可能会重演他们的行为，再次对开发者进行个人攻击，同时寻求法律途径。这不仅在 EIP-1057 期间表现出来，在 EIP-969 的近期讨论中，他们的法律威胁导致该 EIP 的倡导者退出，迫使我匿名提交此 EIP。以太坊不能允许其参与者在没有后果的情况下受到威胁，这是一场必须在他们弱小时进行的斗争，而不是在合并前他们变得更强时，这将导致合并延迟并损害以太坊的价值。

ASIC 拥有最大的激励和资源来实施不当行为，因为它们集中在矿场中，这就是为什么维塔利设计 ETH 以抵抗 ASIC，因为 ASIC 已经破坏了 BTC 的去中心化原则。每天，他们对网络的控制力和影响力都在增长。ASIC 违背了以太坊的创始原则，促进了一个由普通人而非大型仓库的单一所有者运营的去中心化系统。F2Pool 主要由 ASIC 矿场组成，已成为第三大矿池，控制着约 10% 的哈希率。他们的矿场可以在他们的网页上查看。2020 年 11 月，他们的算力为 23TH/s，而今天为 45.6 TH/s。这在 4 个月内翻了一番，随着更多 ASIC 上线，他们的增长正在加速。ASIC 正成为一个威胁，很快将主导网络，必须立即采取行动以阻止他们。

F2Pool 上的 ASIC 长期以来被认为是 BTC 网络上的“坏演员”。他们以市场操纵和抛售 BTC 来操纵价格而闻名（我无法发布源链接，因为这是一个新账户）。一旦这些 ASIC 发现他们即将损失数百万，他们会怎么做？以太坊不仅是一个网络，它是一个社区，他们将利用他们的财务资源，投入数百万来延迟合并，发起一场又一场的法律诉讼。他们将攻击开发者和社区，试图榨取每一分钱。

以太坊之所以建立在反 ASIC 的原则上，是因为维塔利看到了 ASIC 对 BTC 网络造成的损害，因为他们追求利润而非网络的改善。GPU 矿工是去中心化和无组织的，这使他们的威胁远低于一个集中在一个中央公司的仓库，因此无法因不当行为而承担责任。

EIP-3372 还致力于保护环境。合并后，GPU 将进入二级市场或转向其他币种。然而，ASIC 将变成废物。随着更多 ASIC 的生产，以太坊的环境足迹在增加。这些 ASIC 的大规模生产数量不断增加，尽管合并正在加速。显然，这些 ASIC 制造商和买家要么对加速合并无知，要么计划延迟合并。因为他们抛售他们的 ETH，他们在网络中没有任何利益，除了他们能榨取的金钱，如果通过制造麻烦他们能再多争取一天，他们就会这样做。

最后，以太坊一直寻求追求“最低发行”。通过减少可能对网络构成威胁的矿工数量，以太坊也减少了其为保护支付的费用。一些 EIP 正在准备在 EIP-1559 后增加矿工收入，以防出现威胁。EIP-3372 消除了支付更多安全费用的必要性，并允许矿工在不妥协网络安全的情况下获得更少的报酬。随着我们逐渐接近合并，社区必须减少攻击向量，以降低合并本身的成本并最大化网络的安全性。社区已经为保护支付了过多的费用，通过减少威胁，我们可以降低这一成本。ASIC 仓库矿场正在抛售他们所挖掘的所有 ETH，这抑制了 ETH 的价格。尽管很少见，但一些个体 GPU 矿工参与了质押，或已加入社区进行开发或我们的金融事业。因此，他们对社区的价值超过了一堆即将变成废物的仓库。以太坊社区没有必要继续为即将过时的硬件支付费用，这些硬件最终将被丢弃。
### 技术概述

Ethash 1.1 将在哈希计算阶段用五个新质数替换唯一的 FNV 质数。用于 DAG 生成的质数保持不变，而其他所有质数都将被更改。这不会阻止 ASIC 公司创建适应的新 ASIC，但由于距离合并太近，他们不太可能这样做，即使他们这样做，也不太可能生产足够的数量再次构成威胁。FNV 常数的选择基于可在 [https://tools.ietf.org/html/draft-eastlake-fnv-14#section-2.1](https://ietf) 上获得的正式规范。

我们为提交此 EIP 的理由延迟表示歉意。社区可能知道或不知道，原始倡导者因 ASIC 公司的法律攻击被迫停止对该 EIP 的工作。我们花了这么长时间来审查他的工作并找到新的倡导者。为了保护自己，我们匿名提交此请求，并希望社区在我们努力保持匿名以及考虑到我们在追求此 EIP 时面临的情况和威胁时给予一些宽容。

## 向后兼容性

如果 `fnv` 常数被嵌入到硬件中并且无法更改，则针对 ethash 优化的挖矿硬件可能不再有效。

## 测试向量

```json
{
  "first": {
    "nonce": "4242424242424242",
    "mixHash": "aa6a928db9b548ebf20fc9a74e9200321426f1c2db1571636cdd3a33eb162b36",
    "header": "f901f3a00000000000000000000000000000000000000000000000000000000000000000a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347940000000000000000000000000000000000000000a09178d0f23c965d81f0834a4c72c6253ce6830f4022b1359aaebfc1ecba442d4ea056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421b90100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008302000080830f4240808080a058f759ede17a706c93f13030328bcea40c1d1341fb26f2facd21ceb0dae57017884242424242424242",
    "seed": "0000000000000000000000000000000000000000000000000000000000000000",
    "result": "3972318778d2af9d3c5c3dfc463bc2a5ebeebd1a7a04392708ff94d29aa18c5f",
    "cache_size": 16776896,
    "full_size": 1073739904,
    "header_hash": "2a8de2adf89af77358250bf908bf04ba94a6e8c3ba87775564a41d269a05e4ce",
    "cache_hash": "35ded12eecf2ce2e8da2e15c06d463aae9b84cb2530a00b932e4bbc484cde353"
  },
  "second": {
    "nonce": "307692cf71b12f6d",
    "mixHash": "4a2ef8287dc21f5def0d4e9694208c56e574b1692d7b254822a3f4704d8ad1ba",
    "header": "f901f7a01bef91439a3e070a6586851c11e6fd79bbbea074b2b836727b8e75c7d4a6b698a01dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d4934794ea3cb5f94fa2ddd52ec6dd6eb75cf824f4058ca1a00c6e51346be0670ce63ac5f05324e27d20b180146269c5aab844d09a2b108c64a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421b90100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008302004002832fefd880845511ed2a80a0e55d02c555a7969361cf74a9ec6211d8c14e4517930a00442f171bdb1698d17588307692cf71b12f6d",
    "seed": "0000000000000000000000000000000000000000000000000000000000000000",
    "result": "5ab98957ba5520d4e367080f442e37a047cfd9d2857b6e00dd12d82900d108a6",
    "cache_size": 16776896,
    "full_size": 1073739904,
    "header_hash": "100cbec5e5ef82991290d0d93d758f19082e71f234cf479192a8b94df6da6bfe",
    "cache_hash": "35ded12eecf2ce2e8da2e15c06d463aae9b84cb2530a00b932e4bbc484cde353"
  }
}
```

## 安全考虑

此更改没有已知的安全问题。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。