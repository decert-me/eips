---
eip: 1109
title: PRECOMPILEDCALL 操作码（移除预编译合约的 CALL 成本）
author: Jordi Baylina (@jbaylina)
discussions-to: https://ethereum-magicians.org/t/eip-1109-remove-call-costs-for-precompiled-contracts/447
status: Stagnant
type: Standards Track
category: Core
created: 2018-05-22
---

## 简单总结

此 EIP 创建了一个名为 `PRECOMPILEDCALL` 的特定操作码，以在不产生正常 `CALL` 成本的情况下调用预编译合约。

## 摘要

此 EIP 试图解决调用预编译合约时高 gas 消耗的问题，使用此操作码调用预编译合约可以定义有效成本低于 700 的预编译合约。

## 动机

每个预编译合约都有一个已定义的调用成本。增加 CALL 操作码的隐含额外 gas 成本是没有意义的。

例如，SHA256 预编译合约的成本为 60，而 ECADD 的成本为 500（在 [EIP-1108](./eip-1108.md) 中提议仅为 50）。当调用预编译合约时，仅 CALL 操作码就消耗了 700 gas，此外还有预编译合约的成本。

这没有意义，目前不可能定义一个有效成本低于 700 的预编译合约。

## 规范

如果 `block.number >= XXXXX`，定义一个名为 `PRECOMPILEDCALL` 的新操作码，代码值为 `0xfb`。

该操作码的 gas 成本为 2（Gbase）加上为每个特定预编译智能合约定义的特定 gas 成本。

该操作码从栈中取出 5 个字，并返回 1 个字到栈中。

输入栈值为：

mu_s[0] = 被调用的预编译智能合约的地址。
mu_s[1] = 输入参数的内存指针。
mu_s[2] = 输入参数的字节长度。
mu_s[3] = 存储输出的内存指针。
mu_s[4] = 输出缓冲区的长度。

成功调用时返回 1，以下情况返回 0：

1.- mu_s[0] 是未定义的预编译智能合约的地址。
2.- 预编译智能合约失败（如每个智能合约所定义的）。例如，输入参数无效。

预编译智能合约不执行操作码，因此不需要像正常 `CALL`（`0xf1`）那样传递 gas 参数。如果可用 gas 少于 2 加上特定预编译智能合约所需的 gas，则上下文将停止执行并出现“Out of Gas”错误。

此调用没有栈检查。

对预编译智能合约的正常 `CALL` 继续以完全相同的行为工作。

对常规地址或常规智能合约的 `PRECOMPILEDCALL` 被视为对“未定义智能合约”的调用，因此虚拟机不得执行它，操作码必须返回 0x0。

## 理由

最初有一个提案是移除 `CALL` 的 gas 成本，但看起来实现和测试一个专门用于此的新操作码更容易。

该代码是 `STATICCALL` 操作码之后的下一个可用操作码。

## 向后兼容性

此 EIP 向后兼容。使用此新操作码调用预编译合约的智能合约将从现在起成本更低。

使用 `CALL` 方法调用预编译智能合约的旧合约将继续工作。

## 测试用例

- 对已定义的预编译合约的正常调用。
- 对未定义的预编译合约的调用。
- 对常规合约的调用。
- 对常规账户的调用。
- 对 0x0 智能合约的调用（不存在）。
- 使用大值作为偏移指针和长度的调用。
- 使用调用智能合约所需的确切剩余 gas 的调用。
- 使用调用智能合约所需的确切剩余 gas 减一的调用。

## 实现

尚未实现。

## 版权
版权及相关权利通过 [CC0](../LICENSE.md) 放弃。