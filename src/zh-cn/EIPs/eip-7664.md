---
eip: 7664
title: 访问密钥操作码
description: 访问密钥操作码使合约能够读取在访问列表中静态声明的输入。
author: Diederik Loerakker (@protolambda)
discussions-to: https://ethereum-magicians.org/t/access-key-opcode/19395
status: 撤回
withdrawal-reason: 小众用例，更好地通过 EIP-7702 实现。
type: 标准跟踪
category: 核心
created: 2024-03-27
requires: 1153, 2930, 4844
---

## 摘要

此 EIP 引入了一种新操作码，用于检查执行地址的访问列表密钥。

## 动机

此 EIP 作为顶层调用检测的替代方案，使智能合约能够强制静态声明属性。

之前，应用层合约在账户抽象倡导者的普遍建议下，依赖 `tx.origin` 来强制顶层调用，从而将合约输入编码为交易输入。

虽然交易的访问列表直接影响执行，但它仅影响 gas 成本。
此 EIP 增强了访问列表功能，以提供静态定义合约输入的属性，
而不依赖于顶层调用、`tx.origin` 行为或 gas 内省。

这使智能合约能够可靠地强制静态声明输入。

这是实现 [EIP-2930](./eip-2930.md) 动机中描述的目的的一步：

> 引入访问列表格式和处理该格式的逻辑。
> 该逻辑可以在以后用于许多其他目的，包括区块范围见证，
> 用于 ReGenesis，随着时间的推移朝着静态状态访问的方向发展，等等。

## 规范

### 参数

| 常量                       | 值     |
|----------------------------|--------|
| `ACCESS_KEY_OPCODE_GAS`    | `3`    |
| `ACCESS_KEY_OPCODE_BYTE`   | `0x4B` |

### 操作码

我们添加了一条指令 `ACCESS_KEY`（操作码 `ACCESS_KEY_OPCODE_BYTE`），它从栈顶弹出 `index` 作为大端 `uint256`，并将 `tx.access_list[address][index]` 推回栈上，
如果 `address` 存在于 `tx.access_list` 中且 `index < len(tx.access_list[address])`，
否则推送一个零值的 `bytes32`。

### Gas 成本

该操作码的固定 gas 成本为 `ACCESS_KEY_OPCODE_GAS`。

交易本身的访问列表内容的内在 gas 成本不变。

## 理由

### 交易的静态分析

合约输入的静态声明使高级二层构造和区块构建技术成为可能：
数据在没有 EVM 内省的情况下可用，合约可以可靠地判断执行交易是否向区块构建者和验证节点声明了关键属性。

合约输入的静态声明现在独立于与账户抽象相关的变化，
例如交易捆绑器，以及与 3074 的协议内。

### 全局只读值

类似于 [EIP-1153](./eip-1153.md) 中描述的 `TLOAD`，
`ACCESS_KEY` 操作码为合约提供了一个在 EVM 中与交易消息执行全局相关的视图。

然而，使用 `ACCESS_KEY` 保证是只读的，并且在交易执行期间无法更改。

### 访问列表的实用性

访问列表今天的利用率较低：
很少有用户利用此功能来预热存储交互以降低 gas 成本。
通常，EIP-2930 实现的 gas 成本节省并不适用于那么多用例。

通过此 EIP，访问列表功能的实用性增加，
而无需 EVM 提供额外资源。

### 见证数据

此 EIP 支持应用程序的转型，以减少状态性，
通过支持只读应用状态提供给合约，而无需合约调用者支持数据转发。

访问列表内容可能包含见证数据，合约可以验证并利用无状态性。

### Gas 成本

`ACCESS_KEY_OPCODE_GAS` 的 gas 成本与类似操作的成本相匹配，
特别是 [EIP-4844](./eip-4844.md) 的 `BLOBHASH` 操作码：
该操作码也从栈中弹出一个类似索引的 EVM 字，并根据嵌入交易中的哈希列表将一个完整的 32 字节 EVM 字推回栈上。

然而，[EIP-4844](./eip-4844.md) 的 `BLOBHASH` 功能并不能用于此 EIP，
因为其意图是仅访问静态声明的哈希，而不是 blob 的成本。

### `ACCESS_KEY` 的命名

访问列表目前仅支持访问密钥列表。
该列表不强制排序，因此支持索引查找。

这不是 `LOAD` 操作码，因为 `SLOAD` 或 `TLOAD` 是，因为该操作码返回一个密钥。

## 向后兼容性

### 无交易类型更改

此访问列表实用性的增强不影响访问列表编码，
或支持访问列表的现有交易类型。

### 对 EVM 交易上下文的最小影响

通过 EIP-2930，访问列表内容在 EVM 执行期间已经可以在交易上下文中轻松获取，
以及触发该执行的 RPC 方法。

因此，此 EIP 不需要对 EVM 上下文的构造进行重大更改，
也不需要对 RPC 方法进行任何更改。

## 测试用例

区块费用接收者以及在交易访问列表中未静态声明的任何其他预热属性，
不得被视为访问列表的一部分。

## 安全考虑

访问列表属性在 EIP-2930 中已经进行了 gas 计量，
并且在 EVM 中可以轻松访问以确定存储 gas 成本。在拒绝服务风险方面，
此 EIP 不引入新的重大数据或数据处理成本。

访问列表是只读的，因此对应用程序开发者构成的风险最小。

访问仅限于本来会执行预热 `SLOAD` 的合约，
因此存储布局抽象不会在不同的智能合约应用之间泄漏。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。