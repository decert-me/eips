---
eip: 7542
title: eth/70 - 可用区块扩展协议
description: 在握手中添加更多关于可用区块范围的信息，并添加请求区块范围和发送区块范围的消息类型
author: Ahmad Bitar (@smartprogrammer93) <smartprogrammer@windowslive.com>
discussions-to: https://ethereum-magicians.org/t/eip-eth-70-available-blocks-extended-protocol-handshake/16188
status: 草案
type: 标准跟踪
category: 网络
created: 2023-10-21
requires: 7642
---
## 摘要

本 EIP 的目的是引入一种方法，使以太坊节点能够传达其可用的区块范围。通过了解节点可以提供的区块范围，节点可以在选择请求区块的对象或连接的对象时做出更明智的决策，特别是在寻找特定区块范围时。这可以导致更高效的网络行为。

本 EIP 提议扩展以太坊的 wire 协议（`eth`）握手，引入一个新版本 `eth/70`，该版本将包含有关节点可以提供的区块范围的信息。此外，它还通过两种新消息类型扩展协议，以便在请求时共享更新的区块范围。

## 动机

在 [EIP-4444](./eip-4444.md) 的第一阶段，一些节点仍然需要提供链的历史数据，而其他节点可能有兴趣开始修剪这些数据。目前，节点需要连接到对等节点并请求特定区块，以确定对等节点是否拥有所请求的数据。这可能效率低下，导致不必要的数据请求，浪费带宽和时间。因此，这一变化使得仍希望从网络中检索历史数据的节点能够高效地做到这一点。

作为额外的好处，这一变化通过允许节点确定一个可能仍在同步过程中的对等节点是否具有必要的区块，从而提高了同步的效率，从而避免不必要的区块请求和潜在的空响应。

## 规范

- 在 `eth/70` 上宣传新的 `eth` 协议能力（版本）。
  - 旧的 `eth/69` 协议应继续并行保留，直到 `eth/70` 被实现者充分采用。
- 修改 `eth/70` 的 `Status (0x00)` 消息，在 `forkid` 之后添加一个额外的 `blockRange` 字段：
  - 当前 `eth/69` 的数据包：`[version: P, networkid: P, blockhash: B_32, genesis: B_32, forkid]`
  - 新的 `eth/70` 数据包：`[version: P, networkid: P, blockhash: B_32, genesis: B_32, forkid blockRange]`，
  其中 `blockRange` 为 `[startBlock: uint64, endBlock: uint64]`。

- 引入两种新消息类型：
  - `RequestBlockRange (0x0b)` - 从节点请求对等节点当前区块范围的消息。
  - `SendBlockRange (0x0c): [startBlock: uint64, endBlock: uint64]` - 对 `RequestBlockRange` 的响应，通知请求节点对等节点当前可用的区块范围。

在使用 `eth/70` 连接时，节点应交换 `Status` 消息。之后，它们可以使用 `RequestBlockRange` 和 `SendBlockRange` 消息来保持对对等节点区块范围变化的了解。

节点必须保留连接，无论对等节点的可用区块范围如何，例外情况是，如果节点的对等节点插槽已满且缺乏与具有必要区块范围的对等节点的连接，则可以断开连接以寻找这样的对等节点。

## 理由

在 `eth` 握手中包含可用区块范围可以立即了解对等节点的能力。这可以导致更高效的网络，因为节点可以根据所需的数据优先选择连接。引入新的消息类型允许节点请求其他节点更新的可用区块范围，因为该范围可能因节点同步或修剪区块而变化。与没有所需范围的对等节点保持连接确保了网络的弹性，而例外情况则在对等节点容量已满的情况下促进了高效的区块同步。

## 向后兼容性

本 EIP 以向后不兼容的方式扩展了 `eth` 协议握手，并提议引入一个新版本 `eth/70`。然而，`devp2p` 允许同一 wire 协议的多个版本并行运行。因此，未更新的节点可以继续使用旧版本，如 `eth/69`、`eth/68` 或 `eth/67`。

本 EIP 不影响共识引擎，也不需要硬分叉。

## 测试用例

测试将涉及确保节点能够在握手期间正确传达和理解区块范围信息。此外，还将确保节点能够在请求时正确请求和共享更新的区块范围。

## 安全考虑

这一变化并不是对在实施替代历史区块存储解决方案之前不存储和提供历史区块的标准化。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。