---
eip: 7707
title: 激励访问列表提供
description: 本 EIP 提出了更新访问列表的 gas 成本参数，以激励其使用并提高交易执行效率。
author: Ben Adams (@benaadams), Oleg Iakushkin (@OlegJakushkin)
discussions-to: https://ethereum-magicians.org/t/eip-7707-align-incentives-for-access-list-provisioning/20025
status: 草案
type: 标准跟踪
category: 核心
created: 2024-05-12
requires: 2930
---

## 摘要

本 EIP 降低了访问列表数据的 gas 成本，激励在交易中包含完整有效的访问列表，以提高执行层客户端的数据加载效率。

## 动机

虽然 [EIP-2930](./eip-2930.md) 引入了 `accessLists` 作为 `SLOAD` 预热的机制，通过提前告知 EVM 交易将访问哪些存储槽来降低 gas 成本，但由于涉及的节省与惩罚，实际使用受到限制且不常见。为了实现收支平衡，每个地址需要包含 `24 个存储键`，并且在 `25+` 时每个键节省 `100 gas`；相反，包含未使用键的惩罚为 `1900 gas`，因此在一个键未使用的情况下，收支平衡需要 `43 个键`。\
\
这种情况使得 `accessLists` 的收支平衡和风险回报比在常规交易中很少具有吸引力，因为先前的交易可能导致采取不同的分支并访问略有不同的存储槽。此外，需要非常高数量的 SLOAD 才能开始实现收支平衡。\
\
对于某些客户端，数据加载占据了区块执行时间的 `>70%`。这部分是由于顺序交易执行和对有效随机访问数据的迭代搜索所致。\
\
虽然 NVMe 驱动器具有巨大的吞吐量和 IOPS；但这是它们通过多个队列操作的并发吞吐量，如果数据完全顺序访问，且一个请求等待前一个完成，则它们不会有这种性能，即逐个堆叠 IOPS 延迟端到端不会接近这些驱动器可以提供的最大吞吐量（这与 HDD 世界不同，后者需要寻址到每个读取的不同物理位置）。网络附加存储或云数据磁盘的情况类似；然而，这里的延迟比本地直接 CPU 附加的 NVMe 驱动器（即通过网络卡）更为放大。\
\
如果节点对区块执行所需预加载的数据有一个相对清晰的认识；这可以并行完成，隐藏从执行交易时发现的数据访问的许多延迟。非常类似于 CPU 上的指令流水线隐藏内存访问延迟；交易的数据访问可以被流水线化。这可以导致更快/更便宜的区块执行，并将为未来的并行交易执行提供数据依赖提示，就像其他为更现代硬件开发的新兴链一样。

## 规范

我们将更新 [EIP-2930](./eip-2930.md) 参数：

| 常量 | 值 |
| - | - |
| `ACCESS_LIST_STORAGE_KEY_COST` | 320 |
| `ACCESS_LIST_ADDRESS_COST` | 512 |


## 理由

正如引言中所述，gas 成本效益分析并未鼓励链的用户提供 accessList 提示，尽管该机制已经在协议中（调用 `eth_createAccessList` 将为他们或钱包提供正确的列表以包含）。因此，我们建议降低这些数据访问列表的定价，使其更接近 calldata。\
\
在小的 `call_data` 和 `access_lists` 成本之间平衡竞争环境（并激励交易发送者提供 `access_lists`，因为它们在更快的方式下是交易执行所需的），价格模型更新如下：

使用 `STANDARD_TOKEN_COST * tokens_in_access_lists`，其中 `tokens_in_access_lists = bytes_in_access_lists * 4`，使其发送成本与普通小的调用数据相同。因此我们将得到：

- `32*4*4  = 512` 用于地址（而不是 2400，减少了 4.6 倍）

- `20*4*4  = 320` 用于存储键（而不是 1900，减少了 5.9 倍）

这意味着用户像往常一样为链上数据包含支付 `call_data`。它改变了原始的
[EIP-2930](./eip-2930.md) 逻辑
“覆盖带宽成本”，该逻辑未详细描述且可能已过时。

需要注意的是，这并不是第一次提出 [EIP-2930](./eip-2930.md) 的附加内容。在 [EIP-3521](./eip-3521.md) 中，已经提出了降低，但仅关注于 `ACCESS_LIST_ADDRESS_COST`。

### 示例

当前

| 操作 | 类型 | 访问列表 | 地址的键 | 操作价格 | 访问列表键价格 | 访问列表地址价格 | 每个操作的总 gas |
|------|------|-------------|------------------|----------|----------------------|-------------------------|------------------|
| `SLOAD` | 冷 | 未包含 | - | 2100 | 0 | 0 | 2100 |
| `SLOAD` | 热 | 未包含 | - | 100 | 0 | 0 | 100 |
| `SLOAD` | 热 | 已包含 | - | 100 | - | - | 100 |
| `SLOAD` | 冷 | 已包含 | 1 | 100 | 1900 | 2400 | 4400 |
| `SLOAD` | 无 | 已包含 | 1 | 0 | 1900 | 2400 | 4300 |
| `SLOAD` | 冷 | 已包含 | 10 | 100 | 1900 | 240 | 2240 |
| `SLOAD` | 无 | 已包含 | 10 | 0 | 1900 | 240 | 2140 |
| `SLOAD` | 冷 | 已包含 | 50 | 100 | 1900 | 48 | 2048 |
| `SLOAD` | 无 | 已包含 | 50 | 0 | 1900 | 48 | 1948 |


提议

| 操作  | 类型 | 访问列表   | 地址的键 | 操作价格 | 访问列表键价格 | 访问列表地址价格 | 每个操作的总 gas |
|-------|------|---------------|------------------|----------|----------------------|-------------------------|------------------|
| `SLOAD` | 冷 | 未包含  | -                | 2100     | 0                    | 0                       | 2100             |
| `SLOAD` | 热 | 未包含  | -                | 100      | 0                    | 0                       | 100              |
| `SLOAD` | 热 | 已包含      | -                | 100      | -                    | -                       | 100              |
| `SLOAD` | 冷 | 已包含      | 1                | 100      | 320                  | 512                     | 932              |
| `SLOAD` | 无 | 已包含      | 1                | 0        | 320                  | 512                     | 832              |
| `SLOAD` | 冷 | 已包含      | 10               | 100      | 320                  | 51.2                    | 471              |
| `SLOAD` | 无 | 已包含      | 10               | 0        | 320                  | 51.2                    | 371              |
| `SLOAD` | 冷 | 已包含      | 50               | 100      | 320                  | 10.24                   | 430              |
| `SLOAD` | 无 | 已包含      | 50               | 0        | 320                  | 10.24                   | 330              |


\- 已在变为热时支付

## 向后兼容性

本 EIP 对
[EIP-2930](./eip-2930.md) 进行了小幅更新，涉及现代执行挑战和能力。

## 安全考虑

与
[EIP-2930](./eip-2930.md) 相同


## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。