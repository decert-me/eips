---
eip: 7577
title: EIP 的版本控制方案
description: 基于对其规范部分所做更改的 EIP 版本控制方案。
author: danceratopz (@danceratopz), Ahmad Bitar (@smartprogrammer93)
discussions-to: https://ethereum-magicians.org/t/add-eip-versioning-scheme-for-eips/17295
status: 草案
type: 元
created: 2023-12-13
---

## 摘要

本 EIP 通过应用基于 EIP 规范部分更改的 [语义版本控制 2.0.0](../assets/eip-7577/semver.md)，引入了一个用于 [标准跟踪](./eip-1.md#eip-types) EIP 的版本控制方案，一旦其状态从 `草案` 更改为 `审查`。

## 动机

EIP 规范通常会随着更多人对其进行审查而不断修改，这通常发生在客户端团队开始实施规范并且社区对其与协议其他部分的交互有更好理解时。这些更改可能难以追踪。特别是，由于 EVM 参考测试通常不由客户端团队或 EIP 的作者维护（并且通常不发布），因此很难确定参考测试的发布是否足够，甚至是否有效，以测试 EIP 规范的最新版本或客户端当前实施的规范。

本 EIP 提出了一个语义版本控制方案，并为 EIP 添加了 CHANGELOG 部分，以便在社区内进行更清晰的沟通，并允许在第一眼就能确定更改的范围。此外，客户端实施和测试工具链可以查询 EIP 更改，并自动标记 EIP 当前规范与客户端和测试实现之间的不兼容性。

## 规范

本文档中的关键字 "MUST"、"MUST NOT"、"REQUIRED"、"SHALL"、"SHALL NOT"、"SHOULD"、"SHOULD NOT"、"RECOMMENDED"、"NOT RECOMMENDED"、"MAY" 和 "OPTIONAL" 应按 RFC 2119 和 RFC 8174 中的描述进行解释。

一旦 EIP 移出 "草案" 状态，它 MUST 使用下面概述的 EIP 版本控制方案。它 MAY 在 "草案" 状态下已经使用版本控制方案，这在规范正在积极实施时可能是有用的。如果有多个团队在实施该规范，建议将 EIP 的状态更改为 "审查"。

EIP 版本控制方案 MUST 应用以下语义版本控制方案 `MAJOR.MINOR.PATCH`，基于 [语义版本控制 2.0.0](../assets/eip-7577/semver.md)：

1. `MAJOR`：对规范的重大更改，要求实施更改和对参考测试的更改。
2. `MINOR`：对规范的补充，要求对参考测试添加额外的实施和额外的测试覆盖。
3. `PATCH`：对 EIP 的任何外观更改或重新表述，而不更改规范。

在 EIP 移出草案状态并进行版本控制之前，版本号 MUST 最初具有 `MAJOR` 版本 `0`。

对于通过对 ethereum/EIPs 的拉取请求（PR）所做的每个 EIP 更改，必须在 EIP 的 CHANGELOG 部分添加一个新条目，概述 PR 中所做的更改。此 CHANGELOG 条目 MUST 包括以下内容：

1. 一个遵循上述语义版本控制方案的新版本号。
2. 引入更改的日期。
3. 实施更改的 ethereum/EIPs PR 编号。
4. 每个对 EIP 规范所做更改的一行，包括对更改的简短描述。

此外，必须将新版本添加到 EIP 的 markdown 文件的元数据头（到一个新的 "version" 字段），以便可以轻松解析。

必须在 ethereum/EIPs 存储库中添加工具，以帮助 EIP 作者应用版本控制方案。该工具应自动：

1. 更新 EIP 的 markdown 文件的元数据头中的 EIP 版本。如果 EIP 的状态从 "草案" 更改为 "审查"，版本 MUST 更新为 `1.0.0`。
2. 根据 EIP 版本和 PR 的标题添加新的 CHANGELOG 条目。

为了允许工具进行这些更改，EIP 作者必须在推送到 PR 的分支的提交消息中指明更改的范围。范围通过以 ("`[Mm]ajor:`"、"`[Mm]inor:`" 或 "`[Pp]atch`") 开头的提交消息来指示。多个提交消息可能包含范围；在这种情况下，将应用最严重的范围更改。如果在任何提交消息中无法检测到范围，则合并 PR 将被阻止，直到推送这样的提交消息。

## 理由

在 EIP 的元数据头中提供版本信息允许工具在参考测试或客户端团队中以编程方式解析版本号。目前，执行规范测试存储库包含以太坊执行客户端的共识测试，实施了一个基本的 EIP 版本检查器：EIP 规范测试需要声明测试实现所基于的 EIP 的 markdown 文件摘要 SHA。然后通过 Github API 轮询当前摘要 SHA 的值，以验证自测试实现以来是否没有发生更改。虽然这为测试实施者提供了 EIP 已更改的警告，但显然用途有限。

本 EIP 定义的更丰富的版本控制方案可以为测试工具链提供很大价值。客户端团队可以提供一个接口，报告当前实施的 EIP 版本，参考测试可以在生成的测试中将其实施的版本指定为元数据。这允许测试运行器标记测试为 xfail（预期失败），并在 `MAJOR` 或 `MINOR` 版本不匹配时发出警告。甚至可以自动选择正确的参考测试版本以与客户端实现进行比较，尽管考虑到以太坊开发的速度，维护和跟踪多个版本的测试可能不切实际。

### 案例研究

本节探讨了在撰写时处于积极开发中的现有 EIP 如何应用版本控制方案的示例。

[EIP-4788](./eip-4788.md) 的历史包含对其规范的许多更改。EIP-4788 于 2023-11-28 更新为 "审查" 状态。然而，本案例研究假设 EIP 于 2023-04-11 转为 "审查" 状态，并由于客户端团队实施而更新为版本 1.0.0。

#### 变更日志

- 9.0.1 - 2023-09-26: 更新环形缓冲区大小的理由，#7786。
- 9.0.0 - 2023-09-26: 审计后的调整，#7672。
  - 验证时间戳非零。
  - 使 `HISTORY_BUFFER_LENGTH` 为质数（8191）。
  - 仅加载 calldata。
  - 更新 `BEACON_ROOTS_ADDRESS`。
- 8.0.1 - 2023-08-28: 4788 清理，#7532。
- 8.0.0 - 2023-08-24: v2 的初步尝试，#7456。
  - 要求时间戳输入恰好为 32 字节。
  - 如果时间戳输入与存储值不匹配，则回退（而不是返回零字）。
  - 删除预编译概念，使用提供的字节码的常规智能合约。
- 7.0.3 - 2023-08-01: 提及没有现有信标区块根的创世区块情况，#7445。
- 7.0.2 - 2023-07-07: 明确指定头部架构，#7297。
- 7.0.1 - 2023-07-07: 修复拼写错误，#7293。
- 7.0.0 - 2023-07-05: 限制预编译存储，#7178。
- 6.0.1 - 2023-06-13: 澄清头部和有效性部分，#7179。
- 6.0.0 - 2023-06-12: 更新预编译地址，#7173。
- 5.0.0 - 2023-05-31: 通过根密钥信标根，#7107。
- 4.0.0 - 2023-05-24: 优先使用有状态预编译而非操作码，#7065。
- 3.0.0 - 2023-05-17: 从 CL 发送当前插槽以避免时间戳转换，#7037。
- 2.0.1 - 2023-05-15: 修复拼写错误，#7005。
- 2.0.0 - 2023-05-03: 更新操作码以避免冲突，#6980。
- 1.0.1 - 2023-04-13: 小调整，#6870。
- 1.0.0 - 2023-04-11: 使用区块根；更新为 "草案" 状态，#6859。
  - 由于客户端实施（NethermindEth/nethermind#5476）更新为 "草案"。
  - 使用区块根而非状态根。
  - 根按插槽存储。
  - 在状态中使用环形缓冲区。
  - 使用头部时间戳推导插槽编号，而不是消耗额外的头部空间。
- 0.2.1 - 2023-02-04: 更新为 "停滞" 状态，#6432。
- 0.2.0 - 2022-06-29: 将 "信标区块根" 重命名为 "信标状态根"，#5090。
- 0.1.1 - 2022-05-06: 强制使用包含的 LICENSE 文件，#5055。
- 0.1.0 - 2022-02-17: 添加 EIP-4788：EVM 中的信标状态根，#4788。
## 向后兼容性

不必追溯性地为该 EIP 引入之前版本的 CHANGELOG 或版本。在下次更改 EIP 的规范部分时，作者必须引入 CHANGELOG 部分和遵循上述语义版本控制方案的版本号。

## 安全考虑

无。

## 版权

通过 [CC0](../LICENSE.md) 放弃版权及相关权利。