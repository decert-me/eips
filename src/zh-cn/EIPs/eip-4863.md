---
eip: 4863
title: 信标链推送提款
description: 支持从信标链到 EVM 的验证者提款，通过一种新的“推送式”交易类型。
author: Alex Stokes (@ralexstokes), Danny Ryan (@djrtwo)
discussions-to: https://ethereum-magicians.org/t/eip-4863-beacon-chain-push-withdrawals/8465
status: Stagnant
type: Standards Track
category: Core
created: 2022-02-28
---

## 摘要

引入一种新的 [EIP-2718 交易类型](./eip-2718.md)，以支持从信标链“推送”到 EVM 的验证者提款。

添加区块验证，以确保提款交易在信标链上的处理是合理的。

## 动机

该 EIP 提供了一种将信标链上进行的验证者提款引入 EVM 的方式。
该架构是基于“推送”的，而不是基于“拉取”的，提款在从信标链出队后，必须在执行区块中立即处理。

与基于“拉取”的替代方案（例如 [EIP-4788](./eip-4788.md) + 用户空间提款合约）相比，这种方法在核心协议方面更为复杂（通过提供具有特殊语义的新交易类型），但确实将一个关键特性更紧密地集成到协议本身中。

## 规范

| 常量                          | 值                                            | 单位
|---                            |---                                           |---
| `FORK_TIMESTAMP`              | 待定                                         |
| `WITHDRAWAL_TX_TYPE`          | `0x3`                                       | 字节

从执行时间戳 `FORK_TIMESTAMP` 开始，执行客户端 **必须** 在交易处理和区块验证中引入以下扩展：

### 新交易类型

定义一种新的 [EIP-2718](./eip-2718.md) 交易类型，`TransactionType` 为 `WITHDRAWAL_TX_TYPE`。

`TransactionPayload` 是一个 RLP 编码的列表 `RLP([index, address, amount])`，其中 `index` 是一个 64 位值，唯一标识特定提款，`address` 指的是执行层账户，`amount` 指的是以 wei 为单位的以太值。

这些值由共识层提供。

### 区块有效性

如果一个区块包含 *任何* 类型为 `WITHDRAWAL_TX_TYPE` 的交易，则它们 **必须** 在区块中的 **所有** 其他交易之后。

如果执行客户端接收到一个不符合此条件的区块，则它 **必须** 将该区块视为无效。

### 交易处理

在处理类型为 `WITHDRAWAL_TX_TYPE` 的交易时，实施应将 `WithdrawalTransaction` 指定的 `address` 的余额增加指定的 `amount` wei。

此余额更改是无条件的，**必须** 不会失败。

此交易类型没有相关的 gas 成本。

TODO: 添加日志？

## 理由

### 推送与拉取方法

这种推送方法为验证者提供了相对于处理的小额补贴，而不需要通过正常的 EVM 处理购买 gas，这在基于拉取的方法中是必需的。

当信标链上的必要条件满足时，这种风格也会自动发生，这为验证者提供了更好的用户体验。

### 为什么要新的交易类型？

该 EIP 建议一种新的交易类型，因为它具有与其他现有 EVM 交易类型不同的特殊语义。

一种全新的交易类型将通用 EVM 执行与这种类型的处理隔离，以简化提款的测试和安全审查。

### 为什么新的交易类型没有 (gas) 成本？

在给定时间内，可以到达执行层的此交易类型的最大数量是有限制的（由共识层强制执行），并且此限制保持较小，以便在更广泛的区块执行上下文中，任何执行层的运营成本都是微不足道的。

### 为什么只有余额更新？没有一般的 EVM 执行？

更一般的处理引入了失败的风险，这使得信标链上的会计变得复杂。

该 EIP 建议了一条提款路径，提供了大部分好处，而复杂性成本最小。

### 为什么新的区块验证？

信标链必须能够有效验证给定执行区块中的提款交易是否是基于其自身内部调度逻辑所期望的，以维护提款机制的合理性。

通过要求所有提款交易在每个适用区块的末尾，检查一致性的算法变得简单，从集合的开始线性遍历，直到已知的、有限的（小）数量。

拥有这样的简单排序方案可以促进客户端在提款处理方面的优化，如果提款交易可以自由放置在区块中，这些优化将受到阻碍。

## 向后兼容性

没有问题。

## 安全考虑

共识层对提款交易的验证对于确保适当数量的 ETH 被提取回执行层至关重要。
这种共识层到执行层的 ETH 转移在 EVM 中没有当前的类比，因此值得进行非常高的安全审查。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。