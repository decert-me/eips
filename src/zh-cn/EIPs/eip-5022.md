---
eip: 5022
title: 将 SSTORE 的价格从零到非零提高到 40k gas
author: Green (@greenlucid)
status: Stagnant
type: Standards Track
category: Core
created: 2022-04-20
discussions-to: https://ethereum-magicians.org/t/eip-proposal-increase-cost-of-sstore-from-20k-to-x-when-creating-new-storage/7614
---

### 摘要

当原始槽为零且结果槽为非零时，将 SSTORE 操作码的价格从 `20_000` gas 提高到 `40_000` gas。

### 动机

随着状态变得更大，创建一块新状态的成本增加。然而，创建每个新存储槽的价格并没有增加。
所有资源都合并到同一定价机制中。如果创建新存储槽的价格是固定的，那么就需要手动更改。

不提高 gas 限制的主要原因之一是状态的增加。在这方面，由于创建存储的成本高于其价格，所有其他操作码的用户都在补贴状态的创建。如果状态创建的定价更为精确，提高 gas 限制将更可行，并将使用户受益。

## 理由

### 为什么不同时提高非零到非零的成本？

重写存储不会影响状态增长，这是本 EIP 所解决的主要问题。重写存储的定价可能也被低估。
提高状态增长的价格至少会激励开发者重用存储。

### 为什么不同时增加从非零到零的 gas 退款？

对此需要更多讨论。

### 为什么不采用更好的状态解决方案？

虽然像状态租赁或状态过期这样的解决方案已经研究了很长时间，但它们在短期到中期内不会准备好。因此，短期内修补定价是可取的。操作码重新定价之前已经做过，因此对客户端的开发时间投入不应过大。

### 为什么选择这个具体的金额？

当前的定价是基于在笔记本电脑上对操作码进行基准测试的简单方法。它不仅没有考虑到随着时间推移而对同一资源收取相同价格的长期问题，基准测试本身也不正确。这个价格更接近于原始基准测试应该有的价格。它可以更高，但那可能会过于破坏性。

### 这是否过于破坏性？

此更改将严重影响许多应用的 gas 成本。网络不必以更昂贵的常规交易为代价来补贴状态增长，因此即使这过于破坏性，也将提高网络的健康。

### 规范

| 常量 | 值 |
| - | - |
| `FORK_BLOCK` | 待定 |
| `NEW_STORAGE_PRICE` | `40_000` |

对于 `block.number >= FORK_BLOCK` 的区块，将应用新的 gas 计划。将 `SSTORE_SET_GAS`，即将槽从零设置为非零时的价格，设为 `NEW_STORAGE_PRICE`。所有其他成本保持不变。

### 向后兼容性

依赖于硬编码 gas 成本的合约在创建状态时将会中断。

这是一个 gas 计划的更改，因此在 FORK_BLOCK 之前的时代的交易应按之前的 gas 成本处理。

## 实施

https://github.com/ethereum/go-ethereum/pull/24725

## 安全考虑

待办事项