---
eip: 2031
title: 状态租金 B - 净交易计数器
author: Alexey Akhunov (@AlexeyAkhunov)
discussions-to: https://ethereum-magicians.org/t/eip-2031-net-transaction-counter-change-b-from-state-rent-v3-proposal/3283
status: 停滞
type: 标准跟踪
category: 核心
created: 2019-05-15
requires: 2029
---

## 简单总结
以太坊开始跟踪其状态中的交易数量（目前，仅在引入此更改后跟踪交易数量，因此称为*净*交易计数）。
这是通过在一个特殊合约中递增一个存储槽来完成的，称为*状态计数器合约*（[EIP-2029](./eip-2029.md)）。

## 摘要
这是状态租金路线图的一部分。这个特定的更改使得任何以太坊交易都会递增交易计数器，这是*状态计数器合约*中的一个特殊存储槽。该计数器将用于填充新创建的非合约账户的随机数。这种填充随机数的方式确保了被驱逐的账户在通过发送以太币重新引入后具有重放保护。

## 动机
以太坊目前在状态中没有专门的地方来跟踪交易数量。

## 规范
在状态计数器合约中添加一个新字段，位置为 0（这意味着它位于状态计数器合约的存储槽 0 中，可以通过调用该合约并传入 32 个零字节的参数来读取）。它最终将包含 `txCount`，即截至该点处理的交易总数。在区块 B 之后，或在状态计数器合约部署后（以先到者为准），在每笔交易后递增字段 `txCount`。更新 `txCount` 意味着在位置 0 更新状态计数器合约的存储。这些更改永远不会被撤销。

## 理由
为被驱逐的账户提供重放保护的两种主要替代方案：
1. 临时重放保护。新账户（以及被重新引入的账户）的随机数仍为零，但引入了一个新的 `valid-until` 字段，使得在该字段指定的时间之后，交易无效。这会带来不必要的副作用，因为账户随机数不仅用于重放保护，还用于计算已部署合约的地址（除了那些由 `CREATE2` 创建的合约）。
2. 将新账户（以及被重新引入的账户）的随机数设置为依赖于当前区块号的值。这种方法需要提出一个任意参数，即区块中的最大交易数量，以确保新随机数与现有随机数不会冲突。目前，这主要是私有网络的一个问题，因为它们在一个区块中可能会有显著更多的交易。

## 向后兼容性
此更改不向后兼容，需要激活硬分叉。

## 测试用例
测试用例将基于参考实现生成。

## 实现
将有概念验证实现以完善和澄清规范。

## 版权
版权及相关权利通过 [CC0](../LICENSE.md) 放弃。