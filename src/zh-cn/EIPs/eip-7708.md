---
eip: 7708
title: ETH 转账发出日志
description: 所有 ETH 转账发出日志
author: Vitalik Buterin (@vbuterin), Peter Davies (@petertdavies)
discussions-to: https://ethereum-magicians.org/t/eip-7708-eth-transfers-emit-a-log/20034
status: Draft
type: Standards Track
category: Core
created: 2024-05-17
---

## 摘要

所有 ETH 转账，包括交易、`CALL` 和 `SELFDESTRUCT` 都会发出日志。

## 动机

日志通常用于跟踪以太坊上资产余额的变化。日志适用于 [ERC-20](./eip-20.md) 代币，但不适用于 ETH。来自外部拥有账户（EOA）的 ETH 转账可以从区块中的交易列表中读取，但来自智能合约钱包的 ETH 转账并不会自动记录在任何地方。这在过去已经导致了一些问题，例如早期的交易所通常不正确支持来自智能合约钱包的存款，或者仅在更长的延迟后才支持。这项 EIP 提议每当发生价值转移的 `CALL` 或 `SELFDESTRUCT` 时自动生成一个日志。我们还为交易中的转账添加了类似的日志，以便所有 ETH 转账都可以通过一种机制进行跟踪。

## 规范

### 参数

* `MAGIC`: `待定`

### 功能

每当 (i) 发生非零值的 `CALL`，(ii) 发生非零值转移的 `SELFDESTRUCT`，或 (iii) 发生非零值转移的交易时，发出一个与 LOG3 相同的日志，包含三个主题：(i) `MAGIC`，(ii) 发送者地址，(iii) 接收者地址。日志数据是转移值的大端 32 字节编码。

价值转移交易的 `LOG` 应放置在 EVM 执行创建的任何日志之前。其他两个 `LOG` 在价值转移执行时放置。

## 理由

这是确保所有 ETH 转账以某种记录形式实现的最简单实现，可以通过对节点进行 RPC 调用或请求哈希到区块根的默克尔分支轻松访问。日志类型与 ERC-20 代币标准兼容，但并未在规范中引入任何过于特定的 ERC-20 特性（例如 ABI 编码）。

### 待解决的问题

1. 提取是否也应触发日志？如果是，发送者地址应如何指定？
2. 费用支付是否应触发日志？这将确保“完整性”，因为您可以通过观察日志计算确切的当前余额表，但这将大大增加日志的数量，可能达到不可接受的高水平。

## 向后兼容性

未发现向后兼容性问题。

## 测试用例

待办事项

## 安全考虑

ETH 转账已经至少需要 6700 gas，这远高于 LOG3 操作码（1500 gas）。因此，这项 EIP 不会增加可以放入区块的日志的最坏情况数量。它会在一定程度上增加日志的平均数量。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。