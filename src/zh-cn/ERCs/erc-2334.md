---
eip: 2334
title: BLS12-381 确定性账户层级
author: Carl Beekhuizen (@CarlBeek) <carl@ethereum.org>
discussions-to: https://github.com/ethereum/EIPs/issues/2338
status: Stagnant
type: Standards Track
category: ERC
created: 2019-09-30
requires: 2333
---

## 简要总结

此 EIP 定义了在密钥树中给定密钥或其家族的目的。当与 [EIP-2333](./eip-2333.md) 结合时，种子和对密钥所需目的的了解的组合足以确定一对密钥。

## 摘要

为通过 [EIP-2333](./eip-2333.md) 生成的密钥分配特定目的的标准。它定义了一个 `path`，这是一个字符串，解析为在遍历 [EIP-2333](./eip-2333.md) 生成的密钥树时使用的索引。

## 关于目的的说明

本规范旨在不仅成为以太坊 2.0 标准，还要被更广泛的社区采用，这些社区已经采用了 [BLS12-381 上的 BLS 签名](https://datatracker.ietf.org/doc/draft-irtf-cfrg-bls-signature/)。因此，考虑更广泛行业的需求与以太坊特定需求同样重要。作为这些考虑的一部分，作者的意图是该标准最终迁移到一个更中立的存储库中。

## 动机

以太坊 2.0 以及许多其他项目将使用 BLS12-381 上的 BLS 签名，这是一个 [IETF 提议的标准](https://datatracker.ietf.org/doc/draft-irtf-cfrg-bls-signature/)。这一新方案需要一种新的密钥派生机制，该机制在 [EIP-2333](./eip-2333.md) 中建立。由于对硬化密钥的独占使用、每层密钥数量的增加以及不使用 [BIP32](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki) 进行密钥派生，因此这一新方案与当前形式的规范 ([BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki)) 不兼容。因此，有必要建立一个新的 *path* 来遍历 [EIP-2333](./eip-2333.md) 密钥树。

本 EIP 中指定的路径结构旨在比 [BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) 更通用，因为它没有以 UTXO 为中心的特性 [这导致了以太坊 1.0 中使用的 4 种不同类型的钱包路径](https://github.com/ethereum/EIPs/issues/84#issuecomment-292324521)，并导致了 (草案) [EIP-600](./eip-600.md) 和 [EIP-601](./eip-601.md)

## 规范

### 路径

遍历密钥树的路径由整数（表示兄弟索引）定义，使用 `/` 分隔，表示祖先关系。路径中有 4 个层级（加上主节点），至少必须使用 4 个（包括主节点 5 个）。

```text
m / purpose / coin_type /  account / use
```

#### 符号

路径中使用的符号在 [EIP-2333](./eip-2333.md) 中进行了说明，但为了方便起见，下面再次总结。

* `m` 表示树的主节点（或根）
* `/` 将树分隔为深度，因此 `i / j` 表示 `j` 是 `i` 的子节点

### 目的

`purpose` 设置为 `12381`，这是新曲线 (BLS12-381) 的名称。为了遵守此标准，必须将 [EIP-2333](./eip-2333.md) 实现为 KDF，因此，除非是这种情况，否则 `purpose` `12381` 不得使用。

### 币种类型

这里的 `coin_type` 反映了单个币的币种编号，从而作为分隔不同链所用密钥的手段。

### 账户

`account` 是一个字段，提供用户为不同目的拥有不同密钥集的能力，如果他们愿意的话。这是实现单个用户不同账户的级别。

### 使用

此级别旨在提供一组相关的密钥，可用于任何目的。其理念是单个账户有许多相关但出于安全原因应保持分开的用途。尽管对于许多目的，它将保持为 `0`，但在树中支持此级别是必要的。

### Eth2 特定参数

#### 币种类型

以太坊 2 中 BLS12-381 密钥使用的币种类型为 `3600`。

#### 验证者密钥

每个 Eth2 验证者有两个密钥，一个用于提款和转账（称为 *withdrawal key*），另一个用于执行其作为验证者的职责（以下简称为 *signing key*）。

提款密钥的路径为 `m/12381/3600/i/0`，其中 `i` 表示第 `i` 组验证者密钥。

签名密钥的路径为 `m/12381/3600/i/0/0`，其中同样，`i` 表示第 `i` 组验证者密钥。换句话说，签名密钥是与该验证者的提款密钥相关联的第 `0` 个子节点。

**注意：** 如果上述密钥路径的描述在特定用例中不可行（例如，使用秘密共享或保管验证者），则可以省略受影响的密钥，并通过其他方式派生。此 EIP 的实现必须尽力使用适合给定用例的适当密钥，尽可能合理地做到这一点。（例如，在保管质押的情况下，进行存款的用户将遵循此标准来处理其提款密钥，这与服务提供商如何派生相应的签名密钥无关。）

## 理由

`purpose`、`coin_type` 和 `account` 是根据 [BIP43](https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki) 和 [BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) 广泛采用的术语，因此重用这些术语及其相关含义是合理的。

目的需要与这些标准区分开，因为 KDF 和路径不兼容，`12381` 是一个显而易见的选择。

`account` 将用户活动分隔为不同类别，从而允许用户根据自己的需求分开他们的关注点。

`use` 通常将在应用程序级别确定，为不交叉的用例提供不同的密钥。

### Eth2 特定参数

为 Eth2 密钥选择一个新的币种类型，以帮助确保 Eth2 和 Eth1 密钥之间的清晰分隔。尽管 Eth1 ETH 和 Eth2 ETH 之间的区别微妙，但它们是不同的实体，并且有些服务仅通过其币种名称区分币（例如，[ENS 的多链地址解析](./eip-2304.md) ）。选择 `3600` 是因为它是 Eth1 的 `coin_type` 的平方 (`3600==60^2`)，从而表明它是以太币的第二次实例化。

验证者拥有单独的签名和提款密钥的主要原因是为了应对 Eth2 中不同的安全问题。签名密钥被提供给验证者客户端，验证者根据作为验证者的要求签署消息，因此它是一个“热密钥”。如果此密钥被泄露，最糟糕的情况（在本地）是签署一条可削减的消息，导致验证者被削减并被强制退出。提款密钥仅在验证者希望执行与验证无关的操作时需要，并且可以访问该验证者的全部质押资金。因此，提款密钥具有更高的安全关注，应作为“冷密钥”处理。通过将签名密钥作为提款密钥的子密钥，可以安全存储提款密钥，以便在需要时恢复签名密钥。
## 向后兼容性

[BIP43](https://github.com/bitcoin/bips/blob/master/bip-0043.mediawiki) 和 [BIP44](https://github.com/bitcoin/bips/blob/master/bip-0044.mediawiki) 是在 Ethereum 1.0 中常用的标准，但它们尚未被 `接受` 为标准。由于在 [EIP-2333](./eip-2333.md) 中使用了新的 KDF，因此需要一个新的路径标准。该 EIP 实现了这一点，并进行了小幅修改。

`purpose` `12381` 路径不支持硬化密钥，因此 `'` 字符是无效的。

## 版权

通过 [CC0](../LICENSE.md) 放弃版权及相关权利。