---
eip: 5252
title: 账户绑定金融
description: 一种 ERC-5114 扩展，旨在防止资金的任意损失
author: Hyungsuk Kang (@hskang9), Viktor Pernjek (@smuxx)
discussions-to: https://ethereum-magicians.org/t/pr-5252-discussion-account-bound-finance/10027
status: 停滞
type: 标准跟踪
category: ERC
created: 2022-06-29
requires: 20, 721, 1155, 5114
---

## 摘要

本 EIP 提出了一种智能合约设计模式和一种新的账户抽象类型，关于如何管理个人财务，确保投资管理的透明性以及即使在财务操作员的情况下也能保护自我主权。该 EIP 通过为每个个人提供个人财务合约，增强了个人资产的自我主权。投资者的资金与操作费用之间的分离在个人智能合约中得到了明确规定，因此投资者可以确保免受运营团队控制下的任意资金损失。

该 EIP 扩展了 [ERC-5114](./eip-5114.md)，进一步支持将资金转移到其他账户，以便在管理多个钱包之间实现流动性。

## 动机

去中心化金融（DeFi）面临信任问题。智能合约通常是代理，合约的实际逻辑隐藏在单独的逻辑合约中。许多项目包括一个多签名“钱包”，其权限过于强大。而且无法独立验证稳定币是否拥有足够的现实资产以维持其挂钩，导致资金的大量损失（例如在 Celsius 的官方破产公告和 UST 脱钩及 Anchor 协议失败中发生的情况）。在 Web3.0 中，个人不应信任交易所或其他第三方来管理自己的投资。

智能合约最好作为两方之间用代码书写的承诺来实现，但当前的 DeFi 合约通常使用少于 7 个智能合约来管理整个投资者的资金，并且通常有一个完全控制的受信任密钥。这显然是一个问题，因为投资者必须信任合约操作员管理他们的资金，这意味着用户实际上并不拥有他们的资金。

个人财务合约的模式也提供了比将混合资金财务数据存储在运营团队合约中更高的透明度。使用个人财务合约，账户的活动比一个全局智能合约的活动更容易追踪。该模式引入了一种非同质化账户绑定代币（ABT），用于存储来自个人财务合约的凭证。

### 离线身份与凭证上的灵魂绑定代币

本 EIP 提供了一种比离线身份解决方案更好的替代方案，后者接管整个系统，因为它们的后端最终依赖于操作员的信任，而不是加密证明（例如工作量证明、权益证明等）。离线身份作为凭证与加密的整体前提直接对立。灵魂绑定代币是一种更好的、可验证的凭证，离线存储的数据仅用于存储代币元数据。

## 规范

本文档中的关键字“MUST”、“MUST NOT”、“REQUIRED”、“SHALL”、“SHALL NOT”、“SHOULD”、“SHOULD NOT”、“RECOMMENDED”、“MAY”和“OPTIONAL”应按 RFC 2119 中的描述进行解释。

该规范由 **交互** 和 **治理** 两种模式组成。

### 交互

#### 接口

交互模式由 4 个组件组成；管理者、工厂、财务、账户绑定代币和扩展。

交互合约模式由以下合约定义：

- 一个灵魂绑定或账户绑定代币合约，用于提供与财务合约交互的凭证
- 一个管理者合约，首次与投资者进行交互
- 一个工厂合约，为每个用户创建财务合约
- 一个财务合约，可以与投资者进行交互

#### 要求

灵魂绑定或账户绑定代币合约定义了以下属性：

1. 它必须是非同质化的，并且必须满足 [ERC-721](./eip-721.md)。
2. 凭证应通过 `tokenURI()` 函数以其元数据表示。
3. 它必须仅引用工厂以验证其铸造。
4. 如果它是可转让的，则为账户绑定；如果不可转让，则为灵魂绑定。

管理者合约定义了以下属性：

1. 它必须是唯一调用工厂以创建的合约类型。
2. 它应存储所有与财务参数相关的配置。

工厂合约定义了以下属性：

1. 它必须以统一的实现克隆财务合约。
2. 它必须是唯一可以铸造账户绑定代币的合约。
3. 它必须保持账户绑定代币的最新 ID。

财务合约定义了以下属性：

1. 财务合约必须仅在构造函数中从工厂合约初始化一次。
2. 合约中的资金不得转移到其他合约或账户，除非拥有灵魂绑定或账户绑定代币的发送者签署同意。
3. 智能合约的每个状态更改函数必须仅接受拥有灵魂绑定或账户绑定代币的发送者，除非是全局函数（例如清算）。
4. 全局函数应注释为 `/* global */` 以明确该函数可以被任何人访问。
5. 每个财务合约应能够表示仅与拥有账户绑定代币的用户发生的交易。
6. 如果使用灵魂绑定代币进行访问，则财务合约必须能够表示仅与拥有私钥的用户和财务合约之间发生的交易。

#### 合约

![Diagram](../assets/eip-5252/media/media.svg)

<center>
[ERC-5252](eip-5252.md) 的合约图
</center>

**`管理者`**: **`管理者`**合约作为与投资者交互的入口点。该合约还存储 **`财务`** 合约的参数。

**`工厂`**: **`工厂`**合约管理合约字节码，以创建用于管理投资者资金的合约，并在 **`管理者`** 合约的批准下克隆 **`财务`** 合约。它还铸造账户绑定代币以与 **`财务`** 合约进行交互。

**`财务`**: **`财务`**合约指定管理投资者资金的所有规则。该合约仅可通过拥有账户绑定代币的账户访问。当投资者向 **`管理者`** 合约存入资金时，该合约在扣除操作费用后将资金发送到 **`财务`** 合约账户。

**`账户绑定代币`**: 本 EIP 中的 **`账户绑定代币`** 合约可以提取 **`财务`** 合约的数据并添加元数据。例如，如果存在一个货币市场借贷的 **`财务`** 合约，其 **`账户绑定代币`** 可以使用 SVG 显示协议中的余额。

**`扩展`**: **`扩展`**合约是另一个可以利用 **`财务`** 合约中锁定资金的合约。该合约可以在 **`管理者`** 合约中获得操作员的批准后访问 **`财务`** 合约。`扩展` 的示例用例可以是会员资格。

**`元数据`**: **`元数据`**合约是存储与账户凭证相关的元数据的合约。与凭证相关的数据以特定键存储。图像通常以 SVG 显示，但也可以是离线图像。

---

### 治理

治理模式由 2 个组件组成；影响者和治理者。
#### 接口

#### 需求

一个影响者合约定义了以下属性：

1. 合约应管理投票的倍增器。
2. 合约应设置一个小数以计算标准化分数。
3. 合约应设置一个函数，治理可以决定因子参数。

一个治理合约定义了以下属性：

1. 合约必须满足 OpenZeppelin 的治理合约。
2. 合约应参考影响者合约以获取倍增器。
3. 合约必须限制一旦声明的账户绑定代币的转移，以防止双重投票。

#### 从代币治理到基于贡献的治理

|             | 代币治理                     | 基于凭证的治理                  |
| ----------- | ---------------------------- | -------------------------------- |
| 执行        | 更多代币，更多权力          | 更多贡献，更多权力              |
| 激励        | 更多代币，更多激励          | 更多贡献，更多激励              |
| 惩罚        | 无惩罚                       | 权力丧失                        |
| 分配        | 持有代币的人                | 影响力最大的人                  |

<center>
代币治理与基于凭证的治理
</center>

代币治理不可持续，因为它给予“最想统治的人”**更多**权力。任何获得超过 51% 代币供应的人都可以强行控制。

需要一种新的治理方式，考虑对协议的贡献，因为：

- **统治者在违反协议时可以受到惩罚**
- **统治者在维护协议时可以更有效地获得激励**

权力应给予“最负责任的人”。投票权不是由锁定或拥有的代币决定，而是由在账户绑定代币（ABT）中标记的贡献决定。此 EIP 将这种投票权定义为 **`影响力`**。

#### 计算影响力

**`影响力`** 是对质押代币的倍增器，带来更多 DAO 对其贡献者的投票权。要获得 **`影响力`**，需要在加权贡献矩阵上计算分数。然后，分数被标准化，以给出成员在整个分布中的位置。最后，倍增器根据每个社区成员的位置确定。

#### 计算分数

权重表示每个因素的相对重要性。总重要性是各因素的总和。社区可以在提交提案时添加更多可以标准化的因素。

|     | 描述                                                                 |
| --- | -------------------------------------------------------------------- |
| α   | 当前提案中每个 **`Finance`** 合约的贡献值                               |
| β   | 从当前提案时间戳起，他们维护 **`Finance`** 的时间                     |

```math
(score per each ABT) = α * (contribution value) + β * (time that abt was maintained from now)
```

#### 标准化

标准化用于确保用户在 DAO 中的贡献数据的完整性。
标准化分数可以从提交提案的状态计算得出。

```math
(Normalized score per each ABT) = α * (contribution value)/(total contribution value at submitting tx) + β * (time that abt was maintained)/(time passed from genesis to proposal creation)
```

并且其值在 0 和 1 之间（因为 α + β = 1）。

#### 倍增器

倍增器是根据基础因子 (b) 和倍增器 (m) 线性确定的。

影响力的方程是：

```math
(influence) = m * (sum(normalized_score))
```

#### 示例

例如，如果一个用户有 3 个 **`账户绑定代币`**，每个的标准化分数分别为 1.0、0.5、0.3，锁定代币为 100，倍增器为 0.5，基础因子为 1.5。那么总影响力为：

````math
0.5 * {(1.0 + 0.5 + 0.3) / 3} + 1.5 = 1.8

 The total voting power would be

```math
(投票权) = 1.8 * sqrt(100)  = 18
````

#### 质押者与执行者

|              | 质押者                           | 执行者                                                                               |
| ------------ | --------------------------------- | ----------------------------------------------------------------------------------- |
| 角色         | 质押治理代币以进行投票         | 在系统中贡献，可以提出更改规则的提案，拥有更多投票权，如 1.5                      |
| 人口         | 许多                              | 少数                                                                                 |
| 贡献         | 影响较小                         | 影响较大                                                                             |
| 影响力       | sqrt(锁定代币)                   | 影响力 * sqrt(锁定代币)                                                             |

<center>
质押者与执行者
</center>

**质押者**：质押者是投票支持执行者提案并获得质押代币红利的人。

**执行者**：执行者是承担管理协议风险并通过提出提案和更改协议来为协议做出贡献的人。

#### 合约

**`影响者`**：一个 **`影响者`** 合约存储影响力配置，并根据用户在注册的账户绑定代币合约中的活动来衡量其贡献。该合约在提案最终确定之前对该账户绑定代币进行锁定。

**`治理者`**：**`治理者`** 合约与 OpenZeppelin 中当前的治理合约兼容。对于其特殊用例，它配置影响者管理的因子，并可以访问更改 **`管理者`** 配置的参数。只有 `执行者` 可以提出新参数。

## 理由

### 为最终用户节省 gas

使用多个合约（而不是单个合约）的 gas 成本实际上在长期内节省 gas，如果应用克隆工厂模式。一个合约全局存储用户状态意味着每个用户在与合约交互后实际上是在为其他用户的存储成本付费。这，例如，意味着 MakerDAO 的合约运营成本有时超过 0.1 ETH，限制用户的 CDP 最低存款以节省 gas 成本。为了解决未来用户的低效 n 次收费 gas 成本交互，使用每个用户一个合约。

#### 投资者资金与运营资金的分离

投资者资金与运营费用的分离在智能合约中明确规定，因此投资者可以确保免受运营团队控制下的任意资金损失的安全。

## 向后兼容性

此 EIP 没有已知的向后兼容性问题。

## 参考实现

[参考实现](../assets/eip-5252/README.md) 是一个简单的存款账户合约作为 `Finance` 合约，其贡献值 α 通过存款金额与 ETH 测量。

## 安全考虑

- **`工厂`** 合约必须确保每个 **`Finance`** 合约在工厂中注册，并检查 **`Finance`** 合约是否发送与其绑定所有者相关的交易。

- 在 **`管理者`** 合约或 **`Finance`** 合约中的每个用户函数中，应应用重入攻击保护，或在 delegatecall 之前更改状态。否则，**`Finance`** 可能会生成双重并破坏整个索引。

- 一旦用户在提案投票中锁定影响力，**`账户绑定代币`** 不能转移到另一个钱包。否则，可能会发生双重影响力。

## 版权

版权及相关权利通过 [CC0](../LICENSE.md) 放弃。